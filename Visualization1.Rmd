---
title: "Visualisation 1"
author: "Marion M. & Armelle L."
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Idée : Carte à côté de boxplots avec couleurs correspondantes 

```{r message=FALSE}
library(tidyverse)
library(readxl)
library(ggplot2)
library(ggspatial)
library(leaflet)
library(sf)
library(car)
```

# Import et sélection 

```{r message=FALSE, warning=FALSE}
species <- read_xlsx("data/AVONET Supplementary dataset 1.xlsx", sheet = 2) # on utilise les données de BirdLife
raw_data <- read_xlsx("data/AVONET Supplementary dataset 1.xlsx", sheet = 6) # utile car colonne 'COUNTRY' 
```

On choisit les variables qui nous intéressent puis on lie les noms des pays associés présent dans `raw_data`
```{r}
raw_data <- raw_data %>% select(Avibase.ID, Country_WRI)

species<- species %>% 
  select (Avibase.ID1, Species1, Family1, Order1, Female, Male, Unknown, Beak.Length_Culmen, Beak.Length_Nares, Beak.Width, Beak.Depth, Tarsus.Length, Wing.Length, Kipps.Distance, `Hand-Wing.Index`, Tail.Length, Mass, Habitat, Habitat.Density, Migration, Trophic.Level, Trophic.Niche, Primary.Lifestyle, Min.Latitude, Max.Latitude, Centroid.Latitude, Centroid.Longitude, Range.Size) %>% 
  rename(Species =  Species1, Family = Family1, Order = Order1, Avibase.ID= Avibase.ID1) %>% 
  mutate(Species = as.factor(Species), Family = as.factor(Family), Order = as.factor(Order)) %>% 
  left_join(raw_data) %>% 
  distinct()

```
# Association polygones par pays 

```{r}
attach(species)
data.frame(Classes = c("Species", "Family", "Order"), 
           Effectifs = c(length(levels(Species)),length(levels(Family)),length(levels(Order))))
detach(species)
```

# Première carte 

on récupère les polygones des pays : 
```{r}
nc <- st_read("data/World_Countries.shp")
```

On relie chaque pays à son polygone et on traite si nom des pays différents :
```{r}
sort(unique(species[!(species$Country_WRI %in% nc$COUNTRY), ]$Country_WRI)) # Pays pas reconnu dans `nc`
```
On doit s'amuser à renommer tout ces pays :) 
```{r warning=FALSE}
species.Bis <- species %>% rename(COUNTRY = Country_WRI) %>% 
  mutate(COUNTRY= recode(COUNTRY, "'Cayman Islands'='Cayman Islands (UK)'"), 
         COUNTRY= recode(COUNTRY, "'Faroe Islands'='Faroe Islands (Denmark)'"), 
         COUNTRY= recode(COUNTRY, "'American Samoa'='American Samoa (US)'"),
         COUNTRY= recode(COUNTRY, "'Bermuda'='Bermuda (UK)'"), 
         COUNTRY= recode(COUNTRY, "'British Virgin Islands'='British Virgin Islands(UK)'"),
         COUNTRY= recode(COUNTRY, "'Cook Islands'='Cook Islands (New Zealand)'"),
         COUNTRY= recode(COUNTRY, "'Falkland Islands'='Falkland Islands (UK)'"),
         COUNTRY= recode(COUNTRY, "'French Polynesia'='French Polynesia (France)'"), 
         COUNTRY= recode(COUNTRY, "'French Southern and Antarctic Lands'='French Southern & Antarctic Lands (France)'"), 
         COUNTRY= recode(COUNTRY, "'Gibraltar'='Gibraltar (UK)'"), 
         COUNTRY= recode(COUNTRY, "'Greenland'='Greenland (Denmark)'"), 
         COUNTRY= recode(COUNTRY, "'Guam'='Guam (US)'"), 
         COUNTRY= recode(COUNTRY, "'Guernsey'='Guernsey (UK)'"), 
         COUNTRY= recode(COUNTRY, "'Guinea Bissau'='Guinea-Bissau'"),
         COUNTRY= recode(COUNTRY, "'Montserrat'='Guernsey (UK)'"),
         COUNTRY= recode(COUNTRY, "'Guernsey'='Montserrat (UK)'"),
         COUNTRY= recode(COUNTRY, "'New Caledonia'='New Caledonia (France)'"),
         COUNTRY= recode(COUNTRY, "'Norfolk Island'='Norfolk Island (Australia)'"),
         COUNTRY= recode(COUNTRY, "'Northern Mariana Islands'='Northern Mariana Islands (US)'"),
         COUNTRY= recode(COUNTRY, "'Palau'='Palau (US)'"),
         COUNTRY= recode(COUNTRY, "'Pitcairn Islands'='Pitcairn Islands (UK)'"),
         COUNTRY= recode(COUNTRY, "'Puerto Rico'='Puerto Rico (US)'"),
         COUNTRY= recode(COUNTRY, "'Republic of Congo'='Democratic Republic of the Congo'"),
         COUNTRY= recode(COUNTRY, "'Republic of Serbia'='Serbia'"),
         COUNTRY= recode(COUNTRY, "'Saint Helena'='St. Helena (UK)'"),
         COUNTRY= recode(COUNTRY, "'Saint Lucia'='St. Lucia'"),
         COUNTRY= recode(COUNTRY, "'Saint Vincent and the Grenadines'='St. Vincent and the Grenadines'"),
         COUNTRY= recode(COUNTRY, "'Samoa'='Western Samoa'"),
         COUNTRY= recode(COUNTRY, "'South Georgia and South Sandwich Islands'='South Georgia and the South Sandwich Is (UK)'"),
         COUNTRY= recode(COUNTRY, "'The Bahamas'='Bahamas'"),
         COUNTRY= recode(COUNTRY, "'Timor-Leste'='East Timor'"),
         COUNTRY= recode(COUNTRY, "'Turks and Caicos Islands'='Turks and Caicos Islands (UK)'"),
         COUNTRY= recode(COUNTRY, "'United Republic of Tanzania'='Tanzania'"),
         COUNTRY= recode(COUNTRY, "'United States of America'='United States'"),
         COUNTRY= recode(COUNTRY, "'United States Virgin Islands'='American Virgin Islands (US)'"))
unique(species.Bis[!(species.Bis$COUNTRY %in% nc$COUNTRY), ]$COUNTRY)
```
On met tout les "NA" sous forme NA et on colle les coordonnées des polygones de chaque pays :
```{r}
species.Coord <- species.Bis %>% mutate(COUNTRY= recode(COUNTRY, "'NA'=NA")) %>% left_join(nc) %>% rename()
sum(is.na(species.Coord$COUNTRY))
```
-> Je ne dois pas avoir un pays = une couleur 

# Utilisation des points 

